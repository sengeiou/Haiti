/* ***********************************
 * 	@Copyright : NURITelecom
 * 	@ProjectName : aimir_mdms_moe
 * 	@FileName : PKG_MDM_DATA.sql
 * 	@Author : kyunghee.yoon
 * 	@Date : 2018.09.21
 *************************************/  
 create or replace PACKAGE PKG_MDM_DATA AS
  
	PROCEDURE INSERT_MDM_LP_EM (
		  P_MDEV_ID 		IN VARCHAR2
		, P_YYYYMMDDHHMMSS 	IN VARCHAR2
		, P_MDEV_TYPE 		IN VARCHAR2
		, P_DST 			IN NUMBER		
		, P_METER_ID		IN NUMBER		
		, P_CHANNEL 		IN NUMBER
		, P_MV_VALUE 		IN NUMBER		
		, P_WRITEDATE 		IN VARCHAR2
	);
	
	PROCEDURE INSERT_BILLING_DAY_EM (
		  P_MDEV_ID						IN VARCHAR2
		, P_MDEV_TYPE					IN NUMBER
		, P_YYYYMMDD					IN VARCHAR2
		, P_HHMMSS						IN VARCHAR2
		, P_CUMULACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE1		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE2		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE3		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE4		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE5		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE6		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE7		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE8		IN NUMBER
		, P_CUMULREACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE1	IN NUMBER	
		, P_CUMULREACTIVEENGYIMPORTRATE2	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE3	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE4	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE5	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE6	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE7	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE8	IN NUMBER
		, P_WRITEDATE						IN VARCHAR2
	);

	PROCEDURE INSERT_BILLING_MONTH_EM (
		  P_MDEV_ID						IN VARCHAR2
		, P_MDEV_TYPE					IN NUMBER
		, P_YYYYMMDD					IN VARCHAR2
		, P_HHMMSS						IN VARCHAR2
		, P_CUMULACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE1		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE2		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE3		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE4		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE5		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE6		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE7		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE8		IN NUMBER
		, P_CUMULREACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE1	IN NUMBER	
		, P_CUMULREACTIVEENGYIMPORTRATE2	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE3	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE4	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE5	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE6	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE7	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE8	IN NUMBER
		, P_ACTIVEPWRDMDMAXTIMERATETOT		IN NUMBER
		, P_ACTIVEPWRMAXDMDRATETOT			IN NUMBER
		, P_WRITEDATE						IN VARCHAR2
	);

	PROCEDURE INSERT_METEREVENT_LOG (
		  P_ACTIVATOR_ID 	IN VARCHAR2
		, P_METEREVENT_ID	IN VARCHAR2
		, P_OPEN_TIME		IN NUMBER
		, P_ACTIVATOR_TYPE 	IN VARCHAR2		
		, P_MESSAGE			IN VARCHAR2		
		, P_WRITETIME 		IN VARCHAR2
	);	

END PKG_MDM_DATA;


create or replace PACKAGE BODY PKG_MDM_DATA AS
	
	/* INSERT_MDM_LP_EM */
	PROCEDURE INSERT_MDM_LP_EM (
		 P_MDEV_ID 		IN VARCHAR2
		, P_YYYYMMDDHHMMSS 	IN VARCHAR2
		, P_MDEV_TYPE 		IN VARCHAR2
		, P_DST 			IN NUMBER	
		, P_METER_ID		IN NUMBER	
		, P_CHANNEL 		IN NUMBER
		, P_MV_VALUE 		IN NUMBER		
		, P_WRITEDATE 		IN VARCHAR2
	) AS 	        
        V_INSTALL_PROPERTY VARCHAR(10) :=NULL; 		
	BEGIN
        
        IF P_CHANNEL >= 1 AND P_CHANNEL <= 15 THEN
		MERGE INTO MDM_LP_EM T1
		USING DUAL 
		ON 	( 
					T1.YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS					
				AND	T1.MDEV_ID = P_MDEV_ID
				AND	T1.MDEV_TYPE = P_MDEV_TYPE
				AND	T1.DST = P_DST
			)			
		WHEN NOT MATCHED THEN		
			INSERT (
			  YYYYMMDDHHMMSS			
			, MDEV_ID
			, MDEV_TYPE				
			, DST		
			, METER_ID
			, INSTALL_PROPERTY            
			, WRITEDATE
			)
		VALUES (
			P_YYYYMMDDHHMMSS			
			, P_MDEV_ID
			, P_MDEV_TYPE
			, P_DST
			, P_METER_ID
			, V_INSTALL_PROPERTY            
			, P_WRITEDATE);

		CASE 
            WHEN P_CHANNEL = 1 THEN 
				UPDATE MDM_LP_EM SET CH1 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
            WHEN P_CHANNEL = 2 THEN
                UPDATE MDM_LP_EM SET CH2 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
            WHEN P_CHANNEL = 3 THEN
                UPDATE MDM_LP_EM SET CH3 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;        
            WHEN P_CHANNEL = 4 THEN
				UPDATE MDM_LP_EM SET CH4 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 5 THEN
				UPDATE MDM_LP_EM SET CH5 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 6 THEN
				UPDATE MDM_LP_EM SET CH6 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 7 THEN
				UPDATE MDM_LP_EM SET CH7 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 8 THEN
				UPDATE MDM_LP_EM SET CH8 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 9 THEN
				UPDATE MDM_LP_EM SET CH9 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 10 THEN
				UPDATE MDM_LP_EM SET CH10 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 11 THEN
				UPDATE MDM_LP_EM SET CH11 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 12 THEN
				UPDATE MDM_LP_EM SET CH12 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 13 THEN
				UPDATE MDM_LP_EM SET CH13 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 14 THEN
				UPDATE MDM_LP_EM SET CH14 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;
			WHEN P_CHANNEL = 15 THEN
				UPDATE MDM_LP_EM SET CH15 = P_MV_VALUE WHERE YYYYMMDDHHMMSS = P_YYYYMMDDHHMMSS AND MDEV_ID = P_MDEV_ID AND MDEV_TYPE = P_MDEV_TYPE AND DST = P_DST;			
        END CASE;   

		END IF;

	END INSERT_MDM_LP_EM;


	/* INSERT_BILLING_DAY_EM */
	PROCEDURE INSERT_BILLING_DAY_EM (
		  P_MDEV_ID						IN VARCHAR2
		, P_MDEV_TYPE					IN NUMBER
		, P_YYYYMMDD					IN VARCHAR2
		, P_HHMMSS						IN VARCHAR2
		, P_CUMULACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE1		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE2		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE3		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE4		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE5		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE6		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE7		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE8		IN NUMBER
		, P_CUMULREACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE1	IN NUMBER	
		, P_CUMULREACTIVEENGYIMPORTRATE2	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE3	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE4	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE5	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE6	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE7	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE8	IN NUMBER
		, P_WRITEDATE						IN VARCHAR2
	) AS 	
	BEGIN
		MERGE INTO MDM_BILLING_DAY_EM T1
		USING DUAL 
		ON 	( 
					T1.MDEV_ID = P_MDEV_ID
				AND	T1.YYYYMMDD = P_YYYYMMDD
				AND	T1.HHMMSS = P_HHMMSS
				AND	T1.MDEV_TYPE = P_MDEV_TYPE
			)			
		WHEN NOT MATCHED THEN		
			INSERT (
			  MDEV_ID			
			, YYYYMMDD
			, HHMMSS			
			, MDEV_TYPE
			, CUMULACTIVEENGYIMPORT
			, CUMULACTIVEENGYIMPORTRATE1
			, CUMULACTIVEENGYIMPORTRATE2
			, CUMULACTIVEENGYIMPORTRATE3
			, CUMULACTIVEENGYIMPORTRATE4
			, CUMULACTIVEENGYIMPORTRATE5
			, CUMULACTIVEENGYIMPORTRATE6
			, CUMULACTIVEENGYIMPORTRATE7
			, CUMULACTIVEENGYIMPORTRATE8
			, CUMULREACTIVEENGYIMPORT
			, CUMULREACTIVEENGYIMPORTRATE1
			, CUMULREACTIVEENGYIMPORTRATE2
			, CUMULREACTIVEENGYIMPORTRATE3
			, CUMULREACTIVEENGYIMPORTRATE4
			, CUMULREACTIVEENGYIMPORTRATE5
			, CUMULREACTIVEENGYIMPORTRATE6
			, CUMULREACTIVEENGYIMPORTRATE7
			, CUMULREACTIVEENGYIMPORTRATE8
			, WRITEDATE
			)
		VALUES (
			P_MDEV_ID
			, P_YYYYMMDD
			, P_HHMMSS			
			, P_MDEV_TYPE
			, P_CUMULACTIVEENGYIMPORT
			, P_CUMULACTIVEENGYIMPORTRATE1
			, P_CUMULACTIVEENGYIMPORTRATE2
			, P_CUMULACTIVEENGYIMPORTRATE3
			, P_CUMULACTIVEENGYIMPORTRATE4
			, P_CUMULACTIVEENGYIMPORTRATE5
			, P_CUMULACTIVEENGYIMPORTRATE6
			, P_CUMULACTIVEENGYIMPORTRATE7
			, P_CUMULACTIVEENGYIMPORTRATE8
			, P_CUMULREACTIVEENGYIMPORT
			, P_CUMULREACTIVEENGYIMPORTRATE1
			, P_CUMULREACTIVEENGYIMPORTRATE2
			, P_CUMULREACTIVEENGYIMPORTRATE3
			, P_CUMULREACTIVEENGYIMPORTRATE4
			, P_CUMULREACTIVEENGYIMPORTRATE5
			, P_CUMULREACTIVEENGYIMPORTRATE6
			, P_CUMULREACTIVEENGYIMPORTRATE7
			, P_CUMULREACTIVEENGYIMPORTRATE8
			, P_WRITEDATE
		);

	END INSERT_BILLING_DAY_EM;


	/* INSERT_BILLING_MONTH_EM */
	PROCEDURE INSERT_BILLING_MONTH_EM (
		  P_MDEV_ID						IN VARCHAR2
		, P_MDEV_TYPE					IN NUMBER
		, P_YYYYMMDD					IN VARCHAR2
		, P_HHMMSS						IN VARCHAR2
		, P_CUMULACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE1		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE2		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE3		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE4		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE5		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE6		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE7		IN NUMBER
		, P_CUMULACTIVEENGYIMPORTRATE8		IN NUMBER
		, P_CUMULREACTIVEENGYIMPORT			IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE1	IN NUMBER	
		, P_CUMULREACTIVEENGYIMPORTRATE2	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE3	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE4	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE5	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE6	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE7	IN NUMBER
		, P_CUMULREACTIVEENGYIMPORTRATE8	IN NUMBER		
		, P_ACTIVEPWRDMDMAXTIMERATETOT		IN NUMBER
		, P_ACTIVEPWRMAXDMDRATETOT			IN NUMBER
		, P_WRITEDATE						IN VARCHAR2
	) AS 	
	BEGIN
		MERGE INTO MDM_BILLING_MONTH_EM T1
		USING DUAL 
		ON 	( 
					T1.MDEV_ID = P_MDEV_ID
				AND	T1.YYYYMMDD = P_YYYYMMDD
				AND	T1.HHMMSS = P_HHMMSS
				AND	T1.MDEV_TYPE = P_MDEV_TYPE
			)			
		WHEN NOT MATCHED THEN		
			INSERT (
			  MDEV_ID			
			, YYYYMMDD
			, HHMMSS			
			, MDEV_TYPE
			, CUMULACTIVEENGYIMPORT		
			, CUMULACTIVEENGYIMPORTRATE1	
			, CUMULACTIVEENGYIMPORTRATE2	
			, CUMULACTIVEENGYIMPORTRATE3	
			, CUMULACTIVEENGYIMPORTRATE4	
			, CUMULACTIVEENGYIMPORTRATE5	
			, CUMULACTIVEENGYIMPORTRATE6	
			, CUMULACTIVEENGYIMPORTRATE7	
			, CUMULACTIVEENGYIMPORTRATE8	
			, CUMULREACTIVEENGYIMPORT		
			, CUMULREACTIVEENGYIMPORTRATE1	
			, CUMULREACTIVEENGYIMPORTRATE2
			, CUMULREACTIVEENGYIMPORTRATE3
			, CUMULREACTIVEENGYIMPORTRATE4
			, CUMULREACTIVEENGYIMPORTRATE5
			, CUMULREACTIVEENGYIMPORTRATE6
			, CUMULREACTIVEENGYIMPORTRATE7
			, CUMULREACTIVEENGYIMPORTRATE8
			, ACTIVEPWRDMDMAXTIMERATETOT	
			, ACTIVEPWRMAXDMDRATETOT	
			, WRITEDATE
			)
		VALUES (
			P_MDEV_ID
			, P_YYYYMMDD
			, P_HHMMSS			
			, P_MDEV_TYPE
			, P_CUMULACTIVEENGYIMPORT		
			, P_CUMULACTIVEENGYIMPORTRATE1	
			, P_CUMULACTIVEENGYIMPORTRATE2	
			, P_CUMULACTIVEENGYIMPORTRATE3	
			, P_CUMULACTIVEENGYIMPORTRATE4	
			, P_CUMULACTIVEENGYIMPORTRATE5	
			, P_CUMULACTIVEENGYIMPORTRATE6	
			, P_CUMULACTIVEENGYIMPORTRATE7	
			, P_CUMULACTIVEENGYIMPORTRATE8	
			, P_CUMULREACTIVEENGYIMPORT		
			, P_CUMULREACTIVEENGYIMPORTRATE1	
			, P_CUMULREACTIVEENGYIMPORTRATE2
			, P_CUMULREACTIVEENGYIMPORTRATE3
			, P_CUMULREACTIVEENGYIMPORTRATE4
			, P_CUMULREACTIVEENGYIMPORTRATE5
			, P_CUMULREACTIVEENGYIMPORTRATE6
			, P_CUMULREACTIVEENGYIMPORTRATE7
			, P_CUMULREACTIVEENGYIMPORTRATE8
			, P_ACTIVEPWRDMDMAXTIMERATETOT	
			, P_ACTIVEPWRMAXDMDRATETOT		
			, P_WRITEDATE
		);

	END INSERT_BILLING_MONTH_EM;

	/* INSERT_METEREVENT_LOG */	
	PROCEDURE INSERT_METEREVENT_LOG (
		  P_ACTIVATOR_ID 	IN VARCHAR2
		, P_METEREVENT_ID	IN VARCHAR2
		, P_OPEN_TIME		IN NUMBER
		, P_ACTIVATOR_TYPE 	IN VARCHAR2		
		, P_MESSAGE			IN VARCHAR2		
		, P_WRITETIME 		IN VARCHAR2
	)AS 	
	BEGIN

		MERGE INTO MDM_METEREVENT_LOG T1
		USING DUAL 
		ON 	( 
					T1.ACTIVATOR_ID = P_ACTIVATOR_ID
				AND	T1.METEREVENT_ID = P_METEREVENT_ID
				AND	T1.OPEN_TIME = P_OPEN_TIME
				AND	T1.ACTIVATOR_TYPE = P_ACTIVATOR_TYPE
			)			
		WHEN NOT MATCHED THEN		
			INSERT (
			  ACTIVATOR_ID
			, METEREVENT_ID
			, OPEN_TIME
			, ACTIVATOR_TYPE
			, MESSAGE
			, WRITETIME
			)
		VALUES (
			P_ACTIVATOR_ID
			, P_METEREVENT_ID
			, P_OPEN_TIME
			, P_ACTIVATOR_TYPE
			, P_MESSAGE
			, P_WRITETIME
		);

	END INSERT_METEREVENT_LOG;

END PKG_MDM_DATA;